version: 2.1

jobs:
  deploy:
    docker:
      - image: cimg/base:stable
    steps:
      - checkout
      - run:
          name: Install lftp
          command: |
            sudo apt-get update
            sudo apt-get install -y lftp
      - run:
          name: Deploy Changed Theme Files
          command: |
            echo "üîç Checking for changed theme files..."
            CHANGED_FILES=$(git diff --name-only HEAD~1 HEAD | grep '^')

            if [ -z "$CHANGED_FILES" ]; then
              echo "‚úÖ No theme files changed. Skipping deployment."
              exit 0
            fi

            for file in $CHANGED_FILES; do
              echo "‚¨ÜÔ∏è Uploading $file ..."
              lftp -u $SFTP_USER,$SFTP_PASSWORD sftp://$SFTP_HOST <<-EOF
                set ssl:verify-certificate no
                cd /home/hrmdevsspace/public_html/maxcyte.devsspace.com/wp-content/themes/bb-theme-child/
                put -O . $file
                bye
EOF
            done

workflows:
  version: 2
  deploy_on_push:
    jobs:
      - deploy:
          filters:
            branches:
              only: main
