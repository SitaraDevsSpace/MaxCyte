version: 2.1

jobs:
  deploy:
    docker:
      - image: cimg/base:stable
    steps:
      - checkout

      - run:
          name: Install FTP client
          command: sudo apt-get update && sudo apt-get install -y lftp

      - run:
          name: Deploy bb-theme-child via FTP
          command: |
            echo "⬆️ Starting deployment to server..."
            lftp -e "
              set ftp:ssl-allow no;
              set net:timeout 20;
              set net:max-retries 2;
              open -u $FTP_USERNAME,$FTP_PASSWORD $FTP_SERVER;
              mirror -R ./ /maxcyte.devsspace.com/wp-content/themes/bb-theme-child/ --ignore-time --parallel=2 --verbose;
              bye
            "

workflows:
  version: 2
  deploy-workflow:
    jobs:
      - deploy:
          filters:
            branches:
              only: main
